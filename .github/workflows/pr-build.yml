name: Pull request check

on:
  pull_request:
    branches: [ master ]

jobs:
  determine-build-id:
    name: Determine build ID
    runs-on: ubuntu-latest
    outputs:
      build-id: ${{ steps.set-build-id.outputs.build-id }}
    steps:
      - name: Set build ID
        id: set-build-id
        run: |
          build_id="pr${{ github.event.number }}"
          echo "::set-output name=build-id::${build_id}"

  build-check-publish:
    needs: determine-build-id
    uses: ./.github/workflows/build-check-publish.yml
    with:
      build-id: ${{ needs.determine-build-id.outputs.build-id }}
      is-pr-build: true
    secrets:
      SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
